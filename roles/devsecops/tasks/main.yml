---
- name: Generate projects per-user
  k8s:
    kubeconfig: '{{ kubeconfig }}'
    definition: '{{ lookup("template", "project.yml.j2")|from_yaml }}'

- include_role:
    name: ocs
  when: deploy_ocs|default(true)
- include_role:
    name: quay
  when: deploy_quay|default(true)
- include_role:
    name: service_mesh
  when: deploy_service_mesh|default(true)
- include_role:
    name: gogs
  when: deploy_gogs|default(true)
- include_role:
    name: sonarqube
  when: deploy_sonarqube|default(true)
- include_role:
    name: nexus
  when: deploy_nexus|default(true)
- include_role:
    name: 3scale
  when: deploy_3scale|default(true)
- include_role:
    name: load_tasks
  when: deploy_pipeline|default(true)
- include_role:
    name: tekton
  when:
    - deploy_pipeline|default(true)
    - (pipeline_style == 'tekton')|default(true)
- include_role:
    name: jenkins
  when:
    - deploy_pipeline|default(true)
    - (pipeline_style == 'jenkins')|default(false)
