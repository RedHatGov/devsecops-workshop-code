---
- name: Define the build and deploy tasks
  k8s:
    kubeconfig: '{{ kubeconfig }}'
    definition: '{{ lookup("template", "tasks.yml.j2")|from_yaml }}'

- name: Define pipeline resources
  k8s:
    kubeconfig: '{{ kubeconfig }}'
    definition: '{{ lookup("template", "resources_and_pvcs.yml.j2")|from_yaml }}'

- name: Define pipelines
  k8s:
    kubeconfig: '{{ kubeconfig }}'
    definition: '{{ lookup("template", "pipelines.yml.j2")|from_yaml }}'

- name: Kick off maven pipeline runs
  k8s:
    kubeconfig: '{{ kubeconfig }}'
    definition: '{{ lookup("template", "pipelinerun.yml.j2")|from_yaml }}'
